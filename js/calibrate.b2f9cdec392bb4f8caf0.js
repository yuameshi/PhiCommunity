(()=>{"use strict";var e={818:(e,t,r)=>{e.exports=r.p+"assets/packed/calibrate.9f6c.mp3"}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,r),c.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var t=r.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var o=t.getElementsByTagName("script");o.length&&(e=o[o.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e+"../"})(),(()=>{var e=r(818);function t(e){const t=window.calibrateActx.currentTime-window.actxStartTime;console.log(t);var r=1;t>0&&t<=2&&(console.log("Calibration stage 1",e),r=1),t>2&&t<=4&&(console.log("Calibration stage 2",e),r=2),t>4&&t<=6&&(console.log("Calibration stage 3",e),r=3),t>6&&t<=8&&(console.log("Calibration stage 4",e),r=4),document.querySelector("#result"+r).innerText=Math.round(1e3*(t-(2*r-.5)))}window.addEventListener("DOMContentLoaded",(function(){fetch(e).then((e=>e.arrayBuffer())).then((e=>{window.caliBrateAudioArrayBuffer=e})).catch((()=>{alert("错误：无法加载校准音频")}))})),document.querySelector("button#startBtn").addEventListener("click",(function(){null!=window.caliBrateAudioArrayBuffer?(window.calibrateActx=null,window.calibrateActx=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.msAudioContext),window.calibrateActx.decodeAudioData(window.caliBrateAudioArrayBuffer,(function(e){window.calibraceACtxSource=window.calibrateActx.createBufferSource(),window.calibraceACtxSource.buffer=e,window.calibraceACtxSource.connect(window.calibrateActx.destination),window.actxStartTime=window.calibrateActx.currentTime,window.calibraceACtxSource.start(0),window.calibraceACtxSource.addEventListener("ended",(function(){window.calibrateActx.close(),document.querySelector("button#startBtn").removeAttribute("disabled"),document.querySelector("button#clickBtn").removeEventListener("click",t),window.calibrateActx=null}))})),document.querySelector("button#startBtn").setAttribute("disabled","disabled"),document.querySelector("button#clickBtn").addEventListener("click",t)):alert("抱歉，校准音频尚在加载中，请稍后")})),document.body.addEventListener("keydown",(()=>{document.querySelector("button#clickBtn").click()})),document.querySelector("button#cancelBtn").addEventListener("click",(function(){document.querySelector("button#startBtn").removeAttribute("disabled"),document.querySelector("button#clickBtn").removeEventListener("click",t);try{window.calibraceACtxSource.stop()}catch(e){}const e=parseFloat(document.querySelector("#result1").innerText.replace("-","-0")),r=parseFloat(document.querySelector("#result2").innerText.replace("-","-0")),o=parseFloat(document.querySelector("#result3").innerText.replace("-","-0")),n=parseFloat(document.querySelector("#result4").innerText.replace("-","-0")),c=Math.round((e+r+o+n)/4),i=confirm("谱面延时即将被设置为 "+c+" ，是否确认？\n单击“取消”为继续而不保存");i&&(localStorage.setItem("input-offset",c),location.href="../index.html"),i||(location.href="../index.html")}))})()})();